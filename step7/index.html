<!doctype html>
<html data-n-head-ssr prefix="og: http://ogp.me/ns#" lang="ja" data-n-head="%7B%22prefix%22:%7B%22ssr%22:%22og:%20http://ogp.me/ns#%22%7D,%22lang%22:%7B%22ssr%22:%22ja%22%7D%7D">
  <head>
    <title>CYBER LAB</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="ssr" name="google-site-verification" content="Raqbrw7ORHDnSIcDbBXRcaLKyKdGVBKrmA1_T0HChxg"><meta data-n-head="ssr" name="theme-color" content="#6495ED"><meta data-n-head="ssr" data-hid="description" name="description" content="My legendary Nuxt.js project"><meta data-n-head="ssr" data-hid="og:type" property="og:type" content="website"><meta data-n-head="ssr" data-hid="mobile-web-app-capable" name="mobile-web-app-capable" content="yes"><meta data-n-head="ssr" data-hid="apple-mobile-web-app-title" name="apple-mobile-web-app-title" content="CYBER LAB"><meta data-n-head="ssr" data-hid="author" name="author" content="JulienBenda"><meta data-n-head="ssr" data-hid="og:url" property="og:url" content="https://julienbenda.github.io/step7"><meta data-n-head="ssr" data-hid="og:description" property="og:description" content="programming"><meta data-n-head="ssr" data-hid="og:title" property="og:title" content="CYBER LAB - Nuxt.jsで公開するにあたっての調整"><meta data-n-head="ssr" data-hid="og:site_name" property="og:site_name" content="CYBER LAB - Nuxt.jsで公開するにあたっての調整"><meta data-n-head="ssr" data-hid="og:image" property="og:image" content="https://julienbenda.github.io/GitHub.png"><link data-n-head="ssr" rel="icon" type="image/x-icon" href="./favicon.ico?"><link data-n-head="ssr" rel="manifest" href="/_nuxt/manifest.70f71d27.json"><link data-n-head="ssr" rel="shortcut icon" href="/_nuxt/icons/icon_64.e2fc9a.png"><link data-n-head="ssr" rel="apple-touch-icon" href="/_nuxt/icons/icon_512.e2fc9a.png" sizes="512x512"><link data-n-head="ssr" rel="icon" type="image/x-icon" href="./favicon.ico?"><script data-n-head="ssr" async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script data-n-head="ssr">(adsbygoogle=window.adsbygoogle||[]).push({google_ad_client:"ca-pub-4943358250220700",enable_page_level_ads:!0})</script><base href="/"><link rel="preload" href="/_nuxt/158eb594bac7c3fb1f08.js" as="script"><link rel="preload" href="/_nuxt/25603f6506c1ebbbe1fd.js" as="script"><link rel="preload" href="/_nuxt/b1189dec96fba11d98e3.js" as="script"><link rel="preload" href="/_nuxt/277307f5fb619f2d7ea4.js" as="script"><link rel="preload" href="/_nuxt/8dbe85cbab2f50876e18.js" as="script"><link rel="preload" href="/_nuxt/8cffb97fe47b531bf275.js" as="script"><link rel="preload" href="/_nuxt/965250801bf3bd38dd92.js" as="script"><style data-vue-ssr-id="207d3cf0:0 3191d5ad:0 932a8f60:0">.hljs{display:block;overflow-x:auto;padding:.5em;background:#000;color:#f8f8f8}.hljs-comment,.hljs-meta,.hljs-quote{color:#7c7c7c}.hljs-keyword,.hljs-name,.hljs-selector-tag,.hljs-tag{color:#96cbfe}.hljs-attribute,.hljs-selector-id{color:#ffffb6}.hljs-addition,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-string{color:#a8ff60}.hljs-subst{color:#daefa3}.hljs-link,.hljs-regexp{color:#e9c062}.hljs-doctag,.hljs-section,.hljs-title,.hljs-type{color:#ffffb6}.hljs-bullet,.hljs-literal,.hljs-symbol,.hljs-template-variable,.hljs-variable{color:#c6c5fe}.hljs-deletion,.hljs-number{color:#ff73fd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.nuxt-progress{position:fixed;top:0;left:0;right:0;height:2px;width:0;opacity:1;transition:width .1s,opacity .4s;background-color:#fff;z-index:999999}.nuxt-progress.nuxt-progress-notransition{transition:none}.nuxt-progress-failed{background-color:red}@media screen and (orientation:portrait){:root{--font-size:3.5vw;--logo-top:-50px}.articleContainer,.articleItem{display:block}.articleItem{padding:0;margin:calc(25px + 2vw) auto;width:70vw;height:55vw}}@media screen and (orientation:landscape){:root{--font-size:1.5vw;--logo-scale:0}.articleContainer{display:flex;flex-wrap:wrap;justify-content:space-between;flex:1 1 33%}.articleContainer:after{content:"";display:block;width:29vw}.articleItem{padding:0;margin:calc(25px + 2vw) 0;display:block;width:29vw;height:25vw}}html{font-family:Source Sans Pro,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif;word-spacing:1px;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;box-sizing:border-box}body,html{margin:0;padding:0;overflow-x:hidden;font-size:var(--font-size);word-break:break-all;color:#000;-ms-text-size-adjust:none;-webkit-text-size-adjust:none}*,:after,:before{box-sizing:border-box;margin:0}.innerArticleItem{position:relative;box-shadow:.1vh .1vh .5vh .1vh #000;padding:0;width:100%;height:100%;max-width:900px;max-height:900px;margin:auto;background:#fff}main h1,main h2{margin-bottom:calc(var(--font-size)*1);border-bottom:5px solid;text-align:center}main h2{text-align:left;font-size:130%;padding:.5vh 0 .5vh 1vh;border-left:.5vh solid #dc143c;border-bottom:.3vh solid #000}main h3,main li,main p{text-align:left;margin-top:calc(var(--font-size)*1);margin-bottom:calc(var(--font-size)*1)}#top{height:100vh}#blogs{position:absolute;left:0;top:100vh;background:#fff;width:100%;text-align:center;padding:5vh 50px 150px}.nyoibo{border-bottom:2px solid #000;margin:auto;-webkit-animation:nyoibo 1.5s forwards;animation:nyoibo 1.5s forwards}@-webkit-keyframes nyoibo{0%{width:0}to{width:100%}}@keyframes nyoibo{0%{width:0}to{width:100%}}.container{margin:0 auto;padding:0 0 10vh;min-height:100vh;overflow-x:hidden;font-size:calc(var(--font-size));display:flex;justify-content:center;align-items:center;text-align:center}.title{font-family:Quicksand,Source Sans Pro,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif;display:block;font-weight:300;color:#35495e;letter-spacing:1px}.subtitle{font-weight:300;color:#526488;word-spacing:5px;padding-bottom:15px}.links{padding-top:15px}img{box-shadow:.1vh .1vh .5vh .1vh #000;width:60vw;-o-object-fit:contain;object-fit:contain}blockquote{border-left:2px solid #2f4f4f;padding:0 15px}</style>
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div><div><div><main style="padding:5vw"><h1 style="text-align:center;border-color:transparent"><a href="/" class="nuxt-link-active" style="font-size:40%;text-align:left;display:block;margin-bottom:5vh">
                &lt; 記事一覧へ
            </a> <b style="border-bottom:solid .5vh #000;font-size:80%">
                Nuxt.jsで公開するにあたっての調整
            </b> <p style="text-align:right;font-size:40%">
                2020年5月3日 公開
            </p> <picture><source type="image/webp" srcset="/nuxt.webp"> <img alt src="/nuxt.jpeg" style="width:100%;max-width:50%;margin:auto"></picture></h1> <div style="margin-top:5vh;padding:5vw;box-shadow:.1vh .1vh .5vh .1vh #000"><h2 id="github-pages">GitHub Pages</h2>
<p>　この機能に関しては、以前の記事である程度説明しているが、改めてそして追加で重要な説明をしておく。</p>
<blockquote>
<p>Source
Your GitHub Pages site is currently being built from the master branch. Learn more.
User pages must be built from the master branch.</p>
</blockquote>
<p>つまり&lt;username>.github.ioは<strong>masterブランチにWEBページ構成ソースを配置する必要がある</strong>ということである。</p>
<p>　そして、<strong>課金ユーザー</strong>でないと<strong>プライベートリポジトリでサイトは公開できない</strong>。</p>
<p>この二点である。</p>
<blockquote>
<p>以前はmasterでなくても良かったかもしれないという記憶がある。興味ある各位は調べてみるとよい。</p>
</blockquote>
<h2 id="作業用ブランチ作成">作業用ブランチ作成</h2>
<p>　masterに最終的に生成される静的ファイルを置きたい。
なので、コードを書くブランチは別に作成する。</p>
<pre><code class="bash">$ git checkout -b pre</code></pre>
<p>例えば私は「pre」というブランチを作ってみて作業している。</p>
<h2 id="必要なパッケージを追加">必要なパッケージを追加</h2>
<p>　<a href="https://ja.nuxtjs.org/faq/github-pages/">公式ドキュメント</a>に則って、必要なパッケージ<strong>(cross-env, push-dir)</strong>のインストール。</p>
<pre><code class="bash">npm install cross-env push-dir --save-dev</code></pre>
<p>特に「push-dir」はdistディレクトリ配下のファイルを全て対象ブランチにプッシュできるもので、非常に便利である。</p>
<h2 id="packagejsonにスクリプトを追加">package.jsonにスクリプトを追加</h2>
<p>　公式ドキュメントと違って、masterブランチにdeployするので、少々書き換える必要がある。</p>
<pre><code class="json">...
  "scripts": {
    "dev": "nuxt",
    "build": "nuxt build",
    "start": "nuxt start",
    "generate": "nuxt generate",
    "build:master": "DEPLOY_ENV=MASTER nuxt build",
    "generate:master": "DEPLOY_ENV=MASTER nuxt generate",
    "deploy": "push-dir --dir=dist --branch=master --verbose --cleanup",
    "clear-hard-source-cache": "rm -rf node_modules/.cache/hard-source/"
...</code></pre>
<p><strong>"clear-hard-source-cache"</strong>は基本機能に<strong>HardSourceWebpackPlugin</strong>があり、
これを有効にするとキャッシュによってビルド速度が格段に上がる。
あるタイミングでキャッシュを削除するためのコマンドがこれである。
以下に述べるが、</p>
<pre><code class="javascript">...
build: {
    <span class="hljs-attr">hardSource</span>: <span class="hljs-literal">true</span>,
...</code></pre>
<p>この値をtrueに設定することで有効となる。</p>
<h2 id="nuxtconfigjsを修正">nuxt.config.jsを修正</h2>
<pre><code class="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
    <span class="hljs-attr">mode</span>: <span class="hljs-string">'universal'</span>,
    <span class="hljs-comment">/*
     ** Headers of the page
     */</span>
    <span class="hljs-attr">env</span>: {
        <span class="hljs-attr">baseUrl</span>: process.env.BASE_URL || <span class="hljs-string">'http://localhost:3000'</span>
    },
    <span class="hljs-attr">head</span>: {
        <span class="hljs-attr">title</span>: process.env.npm_package_name || <span class="hljs-string">''</span>,
        <span class="hljs-attr">titleTemplate</span>: <span class="hljs-string">'CYBER LAB'</span>,
        <span class="hljs-attr">htmlAttrs</span>: {
            <span class="hljs-attr">prefix</span>: <span class="hljs-string">'og: http://ogp.me/ns#'</span>,
            <span class="hljs-attr">lang</span>: <span class="hljs-string">'ja'</span>
        },
        <span class="hljs-attr">meta</span>: [
            { <span class="hljs-attr">charset</span>: <span class="hljs-string">'utf-8'</span> },
            { <span class="hljs-attr">name</span>: <span class="hljs-string">'viewport'</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">'width=device-width, initial-scale=1'</span> },
            { <span class="hljs-attr">name</span>: <span class="hljs-string">'google-site-verification'</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">'XXXXXXXXXXXXXXXXXXXXXXX'</span> },
            { <span class="hljs-attr">name</span>: <span class="hljs-string">'theme-color'</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">'#6495ED'</span> },
            { <span class="hljs-attr">hid</span>: <span class="hljs-string">'description'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'description'</span>, <span class="hljs-attr">content</span>: process.env.npm_package_description || <span class="hljs-string">''</span> },
            { <span class="hljs-attr">hid</span>: <span class="hljs-string">'og:site_name'</span>, <span class="hljs-attr">property</span>: <span class="hljs-string">'og:site_name'</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">'CYBER LAB'</span> },
            { <span class="hljs-attr">hid</span>: <span class="hljs-string">'og:type'</span>, <span class="hljs-attr">property</span>: <span class="hljs-string">'og:type'</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">'website'</span> },
            { <span class="hljs-attr">hid</span>: <span class="hljs-string">'og:url'</span>, <span class="hljs-attr">property</span>: <span class="hljs-string">'og:url'</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">'https://julienbenda.github.io'</span> },
            { <span class="hljs-attr">hid</span>: <span class="hljs-string">'og:title'</span>, <span class="hljs-attr">property</span>: <span class="hljs-string">'og:title'</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">'CYBER LAB'</span> },
            { <span class="hljs-attr">hid</span>: <span class="hljs-string">'og:description'</span>, <span class="hljs-attr">property</span>: <span class="hljs-string">'og:description'</span>, <span class="hljs-attr">content</span>: process.env.npm_package_description || <span class="hljs-string">''</span> },
            { <span class="hljs-attr">hid</span>: <span class="hljs-string">'og:image'</span>, <span class="hljs-attr">property</span>: <span class="hljs-string">'og:image'</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">'https://julienbenda.github.io/js.jpg'</span> },
        ],
        <span class="hljs-attr">link</span>: [
            { <span class="hljs-attr">rel</span>: <span class="hljs-string">'icon'</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">'image/x-icon'</span>, <span class="hljs-attr">href</span>: <span class="hljs-string">'./favicon.ico?'</span> }
        ]
    },
    <span class="hljs-comment">/*
     ** Customize the progress-bar color
     */</span>
    <span class="hljs-attr">loading</span>: { <span class="hljs-attr">color</span>: <span class="hljs-string">'#fff'</span> },
    <span class="hljs-comment">/*
     ** Global CSS
     */</span>
    <span class="hljs-attr">css</span>: [
        {<span class="hljs-attr">src</span>: <span class="hljs-string">'~/node_modules/highlight.js/styles/ir-black.css'</span>, <span class="hljs-attr">lang</span>: <span class="hljs-string">'css'</span>},
    ],
    <span class="hljs-comment">/*
     ** Plugins to load before mounting the App
     */</span>
    <span class="hljs-attr">plugins</span>: [
    ],
    <span class="hljs-comment">/*
     ** Nuxt.js dev-modules
     */</span>
    <span class="hljs-attr">buildModules</span>: [
        <span class="hljs-string">'@nuxtjs/google-analytics'</span>
    ],
    <span class="hljs-attr">googleAnalytics</span>: {
        <span class="hljs-attr">id</span>: <span class="hljs-string">'xxxxxxxxxxx'</span>
    },
    <span class="hljs-comment">/*
     ** Nuxt.js modules
     */</span>
    <span class="hljs-attr">modules</span>: [
        <span class="hljs-string">'@nuxtjs/pwa'</span>,
    ],
    <span class="hljs-attr">pwa</span>: {
        <span class="hljs-attr">workbox</span>: {
            <span class="hljs-comment">// workbox options</span>
            <span class="hljs-comment">// 以下無駄、gh-pagesのcache ttlは10mで一律変更不能</span>
            <span class="hljs-attr">offline</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-attr">skipWaiting</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">clientsClaim</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">runtimeCaching</span>: [
                {
                    <span class="hljs-attr">urlPattern</span>: <span class="hljs-string">'/_nuxt/'</span>,
                    <span class="hljs-comment">// handler: 'staleWhileRevalidate',</span>
                    <span class="hljs-attr">handler</span>: <span class="hljs-string">'CacheFirst'</span>,
                    <span class="hljs-attr">method</span>: <span class="hljs-string">'GET'</span>,
                    <span class="hljs-attr">strategyOptions</span>: {
                        <span class="hljs-attr">cacheExpiration</span>: {
                            <span class="hljs-attr">maxAgeSeconds</span>: <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">24</span> * <span class="hljs-number">60</span>, <span class="hljs-comment">// 60日</span>
                        },
                        <span class="hljs-attr">cacheableResponse</span>: {
                            <span class="hljs-attr">statuses</span>: [<span class="hljs-number">200</span>],
                        },
                    },
                },
                {
                    <span class="hljs-comment">// デフォルト（最後に記述する）</span>
                    <span class="hljs-attr">urlPattern</span>: <span class="hljs-string">'/*'</span>,
                    <span class="hljs-attr">handler</span>: <span class="hljs-string">'networkFirst'</span>,
                    <span class="hljs-attr">method</span>: <span class="hljs-string">'GET'</span>,
                },
            ],
        }
    },
    <span class="hljs-attr">manifest</span>: {
        <span class="hljs-attr">name</span>: <span class="hljs-string">"CYBER LAB"</span>,
        <span class="hljs-attr">lang</span>: <span class="hljs-string">'ja'</span>,
    },
    <span class="hljs-comment">/*
     ** Build configuration
     */</span>
    <span class="hljs-attr">build</span>: {
        <span class="hljs-attr">hardSource</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-comment">/*
         ** You can extend webpack config here
         */</span>
        extend (config, ctx) {
        }
    }
}</code></pre>
<p>以上はあくまで、一例としてあげているだけで、絶対的とはまだ確信が持てていない。
依存パッケージもあるので、このままやるとエラーが出る。一応調べてみてほしい。
後の記事である程度説明はしたい。</p>
<h2 id="終わり">終わり</h2>
<p>　サラッと説明したが、凄まじく悩むことはたくさんあった。
しかし、エラーログや、ググることでやっとここまでこられた。
プログラマで最も必要な能力の一つにググり力を挙げたい。</p>
</div></main> <center style="margin-bottom:10vh"><a href="/step6" id="blink" style="font-size:80%;margin-right:2vw">
            前の記事　GitHubのSSH設定をする
        </a> <a href="/" class="nuxt-link-active" style="font-size:80%">
            記事一覧へ
        </a> <a href="/step8" id="alink" style="font-size:80%;margin-left:2vw">
            次の記事　Auditsの機能を使ってサイトのグレードを上げる
        </a></center> <footer style="margin-bottom:2vh;text-align:center">© CYBER LAB 2020</footer> <center style="margin-bottom:7vh"><a href="https://forms.gle/yMfcxPtxpsfHzJZ58" rel="noopener noreferrer" target="_blank" style="margin-right:2vw;font-size:2vh">
        Contact Us
    </a> <a href="../privacy-policy" rel="noopener noreferrer" target="_blank" style="font-size:2vh">
        Privacy Policy
    </a></center></div></div></div></div></div><script>window.__NUXT__={layout:"default",data:[{}],fetch:[],error:null,serverRendered:!0,routePath:"/step7"}</script><script src="/_nuxt/158eb594bac7c3fb1f08.js" defer></script><script src="/_nuxt/8dbe85cbab2f50876e18.js" defer></script><script src="/_nuxt/8cffb97fe47b531bf275.js" defer></script><script src="/_nuxt/965250801bf3bd38dd92.js" defer></script><script src="/_nuxt/25603f6506c1ebbbe1fd.js" defer></script><script src="/_nuxt/b1189dec96fba11d98e3.js" defer></script><script src="/_nuxt/277307f5fb619f2d7ea4.js" defer></script>
  </body>
</html>
